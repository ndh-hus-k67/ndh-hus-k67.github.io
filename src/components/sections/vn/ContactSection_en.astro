---
// Import the necessary dependencies.
import ContactIconBlock from "@components/ui/blocks/ContactIconBlock.astro";
import TextInput from "@components/ui/forms/input/TextInput.astro";
import EmailContactInput from "@components/ui/forms/input/EmailContactInput.astro";
import PhoneInput from "@components/ui/forms/input/PhoneInput.astro";
import TextAreaInput from "@components/ui/forms/input/TextAreaInput.astro";
import Icon from "@components/ui/icons/Icon.astro";

// Define the variables that will be used in this component
const title: string = "Contact Us";
const subTitle: string =
  "Do you have questions or need consultation about our products?\nContact HAHUTECH for support and quality mechanical equipment solutions for your project.";
const formTitle: string = "Please fill in the form below";
const formSubTitle: string =
  "We will contact you as soon as possible.";

// Get the full URL for redirect
const redirectUrl = new URL("/en/contact", Astro.url.origin).toString();
---

<!-- Contact Us -->
<section class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14">
  <div class="mx-auto max-w-2xl lg:max-w-5xl">
    <div class="text-center">
      <h1
        class="text-balance text-3xl font-bold tracking-tight text-neutral-800 dark:text-neutral-200 md:text-5xl md:leading-tight"
      >
        {title}
      </h1>
      <p class="mt-2 text-pretty text-base text-neutral-600 dark:text-neutral-400 md:text-lg">
        {subTitle}
      </p>
    </div>

    <div class="mt-12 grid gap-8 lg:grid-cols-2 lg:gap-12">
      <!-- Left Column: Form and Contact Info -->
      <div class="space-y-8">
        <!-- Contact Form -->
        <div class="flex flex-col rounded-xl bg-neutral-50/50 dark:bg-neutral-800/30 p-6 sm:p-8">
          <h2 class="mb-6 text-2xl font-bold text-neutral-700 dark:text-neutral-300">
            {formTitle}
          </h2>

          <!-- Form for user input with various input fields. -->
          <form action="https://submit-form.com/t3QkqmlGS" method="POST">
            <input type="hidden" name="_redirect" value={redirectUrl} />
            <input type="hidden" name="_append" value="false" />

            <!-- Honeypot field to prevent spam -->
            <input
              type="text"
              name="protect_spam"
              style="display:none"
              tabindex="-1"
              autocomplete="off"
            />

            <div class="grid gap-4">
              <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                <TextInput id="firstname" label="First Name" name="firstname" />
                <TextInput id="lastname" label="Last Name" name="lastname" />
              </div>
              <EmailContactInput id="email" />
              <PhoneInput id="phone" />
              <TextAreaInput
                id="message"
                label="Please leave us a message"
                name="message"
              />
            </div>

            <!-- Success message -->
            <div
              id="success-message"
              class="hidden mt-6 p-5 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800"
            >
              <div class="flex items-center gap-3">
                <svg
                  class="w-6 h-6 text-green-600 dark:text-green-400"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                    clip-rule="evenodd"></path>
                </svg>
                <p class="text-base font-medium text-green-800 dark:text-green-200">
                  Thank you! Your message has been sent successfully. We will contact you as soon as possible.
                </p>
              </div>
            </div>

            <div class="mt-6 grid">
              <button
                type="submit"
                id="submit-button"
                class="inline-flex w-full items-center justify-center gap-x-2 rounded-lg border border-transparent bg-yellow-400 px-6 py-4 text-base font-bold text-neutral-700 focus-visible:ring-3 outline-hidden transition duration-300 hover:bg-yellow-500 dark:focus:outline-hidden disabled:pointer-events-none disabled:opacity-50 ring-zinc-500 dark:ring-zinc-200"
              >
                <span id="button-text">Send Message</span>
                <svg
                  id="button-spinner"
                  class="hidden animate-spin h-5 w-5 text-neutral-700"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    class="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    stroke-width="4"></circle>
                  <path
                    class="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
              </button>
            </div>

            <div class="mt-4 text-center">
              <p class="text-base text-neutral-600 dark:text-neutral-400">
                {formSubTitle}
              </p>
            </div>
          </form>
        </div>

        <!-- Company Information -->
        <div class="rounded-xl bg-neutral-50 dark:bg-neutral-800/50 p-6">
          <h3 class="text-lg font-bold text-neutral-800 dark:text-neutral-200 mb-4">
            CONTACT INFORMATION
          </h3>
          <div class="space-y-3 text-sm text-neutral-600 dark:text-neutral-400">
            <p class="font-semibold text-neutral-800 dark:text-neutral-200">
              HAHUTECH Production and Trading Joint Stock Company
            </p>
            <div class="flex items-start gap-2">
              <svg
                class="w-4 h-4 mt-0.5 flex-shrink-0"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                ></path>
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              <p>Dong Nguyen Urban Area – Tu Son – Bac Ninh City</p>
            </div>
            <div class="flex items-center gap-2">
              <svg
                class="w-4 h-4 flex-shrink-0"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                ></path>
              </svg>
              <p>0347741638</p>
            </div>
            <div class="flex items-center gap-2">
              <svg
                class="w-4 h-4 flex-shrink-0"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
                ></path>
              </svg>
              <a
                href="mailto:sales@hahutech.com.vn"
                class="hover:text-yellow-500 transition"
                >sales@hahutech.com.vn</a
              >
            </div>

            <div class="flex items-start gap-2">
              <svg
                class="w-4 h-4 mt-0.5 flex-shrink-0"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              <p>Monday – Saturday / 8:00 AM – 5:30 PM</p>
            </div>
            <div class="pt-3 border-t border-neutral-300 dark:border-neutral-700">
              <p><strong>Tax Code:</strong> xxxxxxx | <strong>Issued by:</strong> Hanoi City</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Column: Map -->
      <div class="space-y-4 flex flex-col">
        <div class="rounded-xl overflow-hidden shadow-xl flex-1">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3721.8493668139586!2d105.9775686!3d21.1185708!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3135091c57ede817%3A0xd6b672980bac087e!2zQ8O0bmcgdHkgY+G7lSBwaOG6p24gc+G6o24geHXhuqV0IHbDoCB0aMawxqFuZyBt4bqhaSBIQUhVVEVDSA!5e0!3m2!1sen!2s!4v1768318073597!5m2!1sen!2s"
            width="100%"
            height="100%"
            style="border:0; min-height: 600px;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade"
            title="HAHUTECH office location at Tu Son, Bac Ninh"
          ></iframe>
        </div>

        <!-- Directions button -->
        <a
          href="https://maps.app.goo.gl/y5pZJ3chnZxP5e8u5"
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center justify-center gap-2 w-full rounded-lg bg-yellow-400 px-4 py-3 text-sm font-bold text-neutral-700 transition duration-300 hover:bg-yellow-500 focus-visible:ring-3 outline-hidden ring-zinc-500 dark:ring-zinc-200"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"
            ></path>
          </svg>
          <span>Get Directions to HAHUTECH</span>
        </a>
      </div>
    </div>

    <!-- Divider -->
    <div class="my-16 relative">
      <div class="absolute inset-0 flex items-center" aria-hidden="true">
        <div class="w-full border-t-2 border-neutral-300 dark:border-neutral-700"></div>
      </div>
      <div class="relative flex justify-center">
        <span class="bg-white dark:bg-neutral-900 px-8 py-3 rounded-full shadow-lg">
          <div class="flex items-center gap-3">
            <svg class="w-8 h-8 text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
            </svg>
            <span class="text-lg font-bold text-neutral-700 dark:text-neutral-300">Support Team</span>
          </div>
        </span>
      </div>
    </div>

    <!-- Support Contact Section -->
    <div class="grid gap-6 sm:grid-cols-2">
      <div class="rounded-xl bg-neutral-50 dark:bg-neutral-800/50 p-6">
        <h3 class="text-xl font-bold text-neutral-800 dark:text-neutral-200 mb-4">
          CONTACT SUPPORT
        </h3>
        <div class="space-y-3 text-sm text-neutral-600 dark:text-neutral-400">
          <p class="font-semibold text-neutral-800 dark:text-neutral-200">
            HAHUTECH Production and Trading Joint Stock Company
          </p>
          <div class="flex items-center gap-3">
            <svg
              class="w-5 h-5 flex-shrink-0"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
              ></path>
            </svg>
              <p>0347741638</p>
          </div>
          <div class="flex items-center gap-3">
            <svg
              class="w-5 h-5 flex-shrink-0"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
              ></path>
            </svg>
            <a
              href="mailto:sales@hahutech.com.vn"
              class="hover:text-yellow-500 transition"
              >sales@hahutech.com.vn</a
            >
          </div>
        </div>
      </div>

      <div class="rounded-xl bg-neutral-50 dark:bg-neutral-800/50 p-6">
        <h3 class="text-xl font-bold text-neutral-800 dark:text-neutral-200 mb-4">
          SALES DEPARTMENT
        </h3>
        <div class="space-y-3 text-sm text-neutral-600 dark:text-neutral-400">
          <p class="font-semibold text-neutral-800 dark:text-neutral-200">
            Nguyen Minh Duc
          </p>
          <div class="flex items-center gap-3">
            <svg
              class="w-5 h-5 flex-shrink-0"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
              ></path>
            </svg>
            <p>0347741638</p>
          </div>
          <div class="flex items-center gap-3">
            <svg
              class="w-5 h-5 flex-shrink-0"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
              ></path>
            </svg>
            <a
              href="mailto:sales@hahutech.com.vn"
              class="hover:text-yellow-500 transition"
              >sales@hahutech.com.vn</a
            >
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Form validation script
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('form');
    if (!form) return;

    const inputs = form.querySelectorAll('input:not([type="hidden"])');

    // Validation messages in English
    const validationMessages: Record<string, string> = {
      firstname: 'Please enter your first name (minimum 2 characters)',
      lastname: 'Please enter your last name (minimum 2 characters)',
      email: 'Please enter a valid email address',
      phone: 'Please enter a valid phone number (9-11 digits)'
    };

    // Custom validation rules
    const validationRules: Record<string, (value: string) => boolean> = {
      firstname: (value) => value.trim().length >= 2,
      lastname: (value) => value.trim().length >= 2,
      email: (value) => /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(value),
      phone: (value) => /^[0-9]{9,11}$/.test(value.replace(/\s/g, ''))
    };

    // Add event listeners to clear errors when user starts typing
    inputs.forEach(input => {
      input.addEventListener('focus', () => {
        const errorSpan = input.parentElement?.querySelector('.error-message') as HTMLElement;
        if (errorSpan && !errorSpan.classList.contains('hidden')) {
          hideError(input as HTMLInputElement, errorSpan);
        }
      });
    });

    // Validate field function
    function validateField(input: HTMLInputElement) {
      const errorSpan = input.parentElement?.querySelector('.error-message') as HTMLElement;
      const fieldName = input.name || input.id;
      const value = input.value;

      // Check if field is empty
      if (!value.trim()) {
        showError(input, errorSpan, 'Please fill in this information');
        return false;
      }

      // Check custom validation rules
      const validationRule = validationRules[fieldName];
      if (validationRule && !validationRule(value)) {
        showError(input, errorSpan, validationMessages[fieldName] || 'Invalid data');
        return false;
      }

      // Valid
      hideError(input, errorSpan);
      return true;
    }

    // Show error function
    function showError(input: HTMLInputElement, errorSpan: HTMLElement | null, message: string) {
      if (errorSpan) {
        errorSpan.textContent = message;
        errorSpan.classList.remove('hidden');
        errorSpan.classList.add('block', 'mt-2');
      }
    }

    // Hide error function
    function hideError(input: HTMLInputElement, errorSpan: HTMLElement | null) {
      if (errorSpan) {
        errorSpan.classList.add('hidden');
        errorSpan.classList.remove('block', 'mt-2');
      }
    }

    // Form submit validation
    form.addEventListener('submit', (e) => {
      let isValid = true;

      inputs.forEach(input => {
        if (!validateField(input as HTMLInputElement)) {
          isValid = false;
        }
      });

      if (!isValid) {
        e.preventDefault();
        return;
      }

      // Show loading state before form submits
      const submitButton = document.getElementById('submit-button') as HTMLButtonElement;
      const buttonText = document.getElementById('button-text') as HTMLElement;
      const buttonSpinner = document.getElementById('button-spinner') as HTMLElement;

      if (submitButton && buttonText && buttonSpinner) {
        submitButton.disabled = true;
        buttonText.classList.add('hidden');
        buttonSpinner.classList.remove('hidden');
      }

      // Let the form submit naturally (will redirect to the _redirect URL)
    });
  });
</script>
