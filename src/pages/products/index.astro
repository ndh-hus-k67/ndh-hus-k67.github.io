---
// Importing necessary components
import MainLayout from "@/layouts/MainLayout.astro";
import PrimaryCTA from "@components/ui/buttons/PrimaryCTA.astro";
import CardSmall from "@components/ui/cards/CardSmall.astro";
import CardWide from "@components/ui/cards/CardWide.astro";
import FeaturesStatsAlt from "@components/sections/features/FeaturesStatsAlt.astro";
import TestimonialsSectionAlt from "@components/sections/testimonials/TestimonialsSectionAlt.astro";

// Importing necessary functions from Astro
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";

// Fetching all the product related content and sorting it by main.id
const allProducts: CollectionEntry<"products">[] = (
  await getCollection("products", ({ id }) => {
    return id.startsWith("vn/");
  })
).sort(
  (a: CollectionEntry<"products">, b: CollectionEntry<"products">) =>
    a.data.main.id - b.data.main.id
);

// Nhóm sản phẩm theo category
const categories = [
  {
    slug: "bu-long",
    name: "Bu Lông",
    description: "Khám phá bộ sưu tập bu lông chất lượng cao của chúng tôi, bao gồm bu lông inox, bu lông lục giác và nhiều loại khác.",
    icon: "M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"
  },
  {
    slug: "oc-vit",
    name: "Ốc Vít",
    description: "Tìm hiểu các loại ốc vít đa dạng từ ốc vít bắn tôn đến ốc vít inox, được thiết kế để đáp ứng mọi nhu cầu cố định.",
    icon: "M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"
  },
  {
    slug: "san-pham-khac",
    name: "Sản Phẩm Khác",
    description: "Khám phá các sản phẩm phụ kiện và công cụ bổ sung khác để hoàn thiện dự án của bạn.",
    icon: "M20 7h-7M20 12h-7M20 17h-7M3 7h4M3 12h4M3 17h4"
  }
];

const productsByCategory = categories.map(category => ({
  ...category,
  products: allProducts.filter(p => p.data.category === category.slug).slice(0, 4),
  count: allProducts.filter(p => p.data.category === category.slug).length
}));

// Define variables for page content
const title: string = "Sản phẩm";
const subTitle: string =
  "Khám phá độ bền và độ chính xác của các công cụ ScrewFast, được thiết kế dành cho cả chuyên gia lẫn người đam mê. Mỗi sản phẩm của chúng tôi đều được chế tạo tỉ mỉ và hướng tới độ bền lâu dài, đảm bảo bạn luôn có đúng công cụ cho mọi công việc.";

// Testimonial data that will be rendered in the component
const testimonials = [
  {
    content:
      "Kể từ khi chúng tôi sử dụng các công cụ phần cứng của ScrewFast, hiệu suất làm việc tại các công trường đã tăng vọt. Độ bền của bu lông lục giác và độ chính xác của vít máy thực sự không có đối thủ. Thật tuyệt khi làm việc với một công ty thực sự hiểu rõ những yêu cầu khắt khe hằng ngày của ngành xây dựng.",
    author: "Jason Clark",
    role: "Giám sát công trường | TopBuild",
    avatarSrc:
      "https://images.unsplash.com/photo-1500648767791-00dcc994a43e?q=80&w=1374&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=facearea&facepad=2&w=320&h=320&q=80",
    avatarAlt: "Mô tả hình ảnh",
  },

  {
    content:
      "Là một nhà thiết kế nội thất, tôi luôn tìm kiếm các vật liệu và công cụ chất lượng cao để hiện thực hóa ý tưởng của mình. Bộ vít tổng hợp của ScrewFast đã thay đổi hoàn toàn các dự án của tôi, mang lại sự kết hợp hoàn hảo giữa chất lượng và sự đa dạng. Dịch vụ hỗ trợ khách hàng tuyệt vời chính là điểm cộng lớn nhất!",
    author: "Maria Gonzalez",
    role: "Nhà thiết kế nội thất | Creative Spaces",
    avatarSrc:
      "https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=1376&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D8&auto=format&fit=facearea&facepad=2&w=320&h=320&q=80",
    avatarAlt: "Mô tả hình ảnh",
  },

  {
    content:
      "Tôi là thợ mộc chuyên nghiệp với hơn 15 năm kinh nghiệm, và có thể khẳng định rằng bu lông và đai ốc taro của ScrewFast thuộc hàng tốt nhất tôi từng sử dụng. Chúng bám chắc vượt trội, mang lại cho tôi sự tin tưởng tuyệt đối trong từng mối ghép. Hơn nữa, dịch vụ của họ thật sự xuất sắc – họ thực sự quan tâm đến thành công của dự án của tôi.",
    author: "Richard Kim",
    role: "Thợ mộc bậc thầy | WoodWright",
    avatarSrc:
      "https://images.unsplash.com/photo-1474176857210-7287d38d27c6?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D8&auto=format&fit=facearea&facepad=2&w=320&h=320&q=80",
    avatarAlt: "Mô tả hình ảnh",
  },
];

const pageTitle = "Sản phẩm | ScrewFast";
const metaDescription =
  "Khám phá độ bền và độ chính xác của các công cụ ScrewFast, được thiết kế dành cho cả chuyên gia lẫn người đam mê.";
const ogTitle = "Dụng cụ phần cứng | ScrewFast";
---

<MainLayout
  title={pageTitle}
  customDescription={metaDescription}
  customOgTitle={ogTitle}
  structuredData={{
    "@context": "https://schema.org",
    "@type": "WebPage",
    "@id": "https://screwfast.uk/products",
    url: "https://screwfast.uk/products",
    name: "Dụng cụ phần cứng | ScrewFast",
    description:
      "Khám phá độ bền và độ chính xác của các công cụ ScrewFast, được thiết kế dành cho cả chuyên gia lẫn người đam mê.",
    isPartOf: {
      "@type": "WebSite",
      url: "https://screwfast.uk",
      name: "ScrewFast",
      description:
        "ScrewFast cung cấp các công cụ phần cứng cao cấp và dịch vụ xây dựng chuyên nghiệp để đáp ứng mọi nhu cầu dự án của bạn.",
    },
    inLanguage: "vn",
  }}
>
  <div
    class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 2xl:max-w-full"
  >
    <div class="mb-4 flex items-center justify-between gap-8 sm:mb-8 md:mb-12">
      <div class="flex items-center gap-12">
        <h1
          class="text-2xl font-bold tracking-tight text-balance text-neutral-800 md:text-4xl md:leading-tight dark:text-neutral-200"
        >
          {title}
        </h1>
        {
          subTitle && (
            <p class="hidden max-w-(--breakpoint-sm) text-pretty text-neutral-600 md:block dark:text-neutral-400">
              {subTitle}
            </p>
          )
        }
      </div>
      <PrimaryCTA
        title="Câu chuyện khách hàng"
        url="#testimonials"
        noArrow={true}
      />
    </div>

    <!-- Categories Section -->
    <div class="space-y-16">
      {
        productsByCategory.map((category) => (
          <section>
            <div class="mb-8 flex items-start justify-between">
              <div>
                <h2 class="text-balance text-2xl font-bold text-neutral-800 md:text-3xl dark:text-neutral-200">
                  {category.name}
                </h2>
                <p class="mt-2 max-w-2xl text-neutral-600 dark:text-neutral-400">
                  {category.description}
                </p>
              </div>
              <a
                href={`/products/${category.slug}`}
                class="flex items-center gap-2 text-sm font-medium text-orange-400 hover:underline whitespace-nowrap dark:text-orange-400"
              >
                Xem tất cả ({category.count}) →
              </a>
            </div>

            <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4 md:gap-6 xl:gap-8">
              {category.products.map((product) => (
                <a
                  href={`/products/${product.data.category}/${product.data.subcategory}/${product.id.split("/").pop()?.replace(".md", "")}`}
                  data-astro-prefetch
                  class="group relative flex h-48 items-end overflow-hidden rounded-xl shadow-lg outline-hidden ring-zinc-500 focus-visible:ring-3 dark:ring-zinc-200 dark:focus:outline-hidden md:h-80"
                >
                  <img
                    src={product.data.main.imgCard.src}
                    alt={product.data.main.imgAlt}
                    class="absolute inset-0 h-full w-full object-cover object-center transition duration-[600ms] ease-[cubic-bezier(0.45,0,0.55,1)] group-hover:scale-110"
                  />
                  <div class="pointer-events-none absolute inset-0 bg-gradient-to-t from-neutral-800 via-transparent to-transparent opacity-50" />
                  <span class="relative mb-3 ml-4 inline-block text-sm font-bold text-neutral-50 transition duration-[600ms] ease-[cubic-bezier(0.45,0,0.55,1)] group-hover:scale-110 md:ml-5 md:text-lg">
                    {product.data.title}
                  </span>
                </a>
              ))}
            </div>
          </section>
        ))
      }
    </div>
  </div>

  <FeaturesStatsAlt
    title="Vì sao nên chọn ScrewFast?"
    subTitle="Biến ý tưởng của bạn thành kết quả thực tế với các công cụ ScrewFast. Dù bạn bắt đầu từ một bản phác thảo đơn giản hay triển khai một dự án xây dựng hoàn chỉnh, công cụ của chúng tôi luôn đồng hành để bạn xây dựng với sự tự tin."
    benefits={[
      "Công cụ bền bỉ và đáng tin cậy cho hiệu suất lâu dài.",
      "Giải pháp sáng tạo phù hợp với nhu cầu xây dựng hiện đại.",
      "Hỗ trợ khách hàng tận tâm cho sự thành công của dự án.",
    ]}
  />

  <div id="customer" class="scroll-mt-24">
  <TestimonialsSectionAlt
    title="Khách hàng nói gì về chúng tôi"
    testimonials={testimonials}
  />
</div>
</MainLayout>
